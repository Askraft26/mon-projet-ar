<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lecteur Vidéo AR Stable - Hybride</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    #overlay {
      position: absolute; z-index: 999; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center;
      color: white; font-family: sans-serif; cursor: pointer; text-align: center;
    }
  </style>
</head>

<body style="margin:0; overflow:hidden; background:#111;">

  <div id="overlay">
    <div>
      <h2>Système Prêt</h2>
      <p>Cliquez pour activer la caméra,<br>puis scannez le marqueur Hiro.</p>
    </div>
  </div>

  <a-scene embedded
           arjs="sourceType: webcam; trackingMethod: best; detectionMode: mono_and_matrix; debugUIEnabled: false;"
           renderer="antialias: true; logarithmicDepthBuffer: true;">
    
    <a-assets>
      <video id="maVideo" src="V2.mp4" crossorigin="anonymous" playsinline webkit-playsinline></video>
    </a-assets>

    <a-marker preset="hiro" id="hiroMarker">
        <a-box position="0 0.1 0" scale="0.2 0.2 0.2" color="#FFD700" animation="property: rotation; to: 0 360 0; loop: true; dur: 2000"></a-box>
    </a-marker>

    <a-entity id="fixedContent" visible="false" position="0 1.6 -3">
      
      <a-video src="#maVideo" width="2.5" height="1.4" position="0 0 0"></a-video>

      <a-entity position="0 -1 0.2">
        <a-box id="btn-play" class="clickable" scale="0.4 0.4 0.1" color="#4CC3D9">
          <a-text value="PLAY" align="center" position="0 0 0.6"></a-text>
        </a-box>
        <a-box id="btn-back" class="clickable" position="-0.6 0 0" scale="0.3 0.3 0.1" color="#FFC65D">
          <a-text value="-5s" align="center" position="0 0 0.6" scale="0.8 0.8 0.8"></a-text>
        </a-box>
        <a-box id="btn-forward" class="clickable" position="0.6 0 0" scale="0.3 0.3 0.1" color="#FFC65D">
          <a-text value="+5s" align="center" position="0 0 0.6" scale="0.8 0.8 0.8"></a-text>
        </a-box>
      </a-entity>

    </a-entity>

    <a-entity camera look-controls wasd-controls position="0 1.6 0">
        <a-cursor raycaster="objects: .clickable" color="white"></a-cursor>
    </a-entity>

  </a-scene>

  <script>
    const overlay = document.querySelector("#overlay");
    const video = document.querySelector("#maVideo");
    const marker = document.querySelector("#hiroMarker");
    const fixedContent = document.querySelector("#fixedContent");
    const btnPlay = document.querySelector("#btn-play");
    const btnText = btnPlay.querySelector("a-text");

    // 1. Activation de l'audio au clic
    overlay.addEventListener('click', () => {
      overlay.style.display = 'none';
      // Préchauffage de la vidéo pour mobile
      video.play().then(() => { video.pause(); });
    });

    // 2. Logique Hybride : Hiro déclenche le contenu permanent
    marker.addEventListener("markerFound", () => {
      if (!fixedContent.getAttribute("visible")) {
        console.log("Marqueur Hiro détecté : Activation du contenu permanent ✅");
        fixedContent.setAttribute("visible", "true");
        // Optionnel : lancer la vidéo automatiquement au scan
        video.play();
        btnText.setAttribute('value', 'PAUSE');
      }
    });

    // 3. Contrôles de la vidéo
    btnPlay.addEventListener('click', () => {
      if (video.paused) {
        video.play();
        btnText.setAttribute('value', 'PAUSE');
      } else {
        video.pause();
        btnText.setAttribute('value', 'PLAY');
      }
    });

    document.querySelector("#btn-back").addEventListener('click', () => {
      video.currentTime -= 5;
    });

    document.querySelector("#btn-forward").addEventListener('click', () => {
      video.currentTime += 5;
    });
  </script>
</body>
</html>
