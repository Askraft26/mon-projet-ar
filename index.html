<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>AR.js – Vidéo au-dessus du marqueur</title>

  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    .clickable {
      cursor: pointer;
    }
  </style>
</head>

<body>

<a-scene
  embedded
  arjs="sourceType: webcam; debugUIEnabled: false;"
  renderer="logarithmicDepthBuffer: true;"
  vr-mode-ui="enabled: false">

  <!-- Assets -->
  <a-assets>
    <video
      id="video"
      src="V.mp4"
      preload="auto"
      loop
      muted
      playsinline
      webkit-playsinline
      crossorigin="anonymous">
    </video>

    <img id="play" src="play.png">
  </a-assets>

  <!-- Marqueur HIRO -->
  <a-marker
    preset="hiro"
    emitevents="true"

    <!-- Tracking très réactif -->
    smooth="true"
    smoothCount="2"
    smoothTolerance="0.005"
    smoothThreshold="2">

    <!-- Vidéo à 4 cm au-dessus du marqueur -->
    <a-video
      id="videoAR"
      src="#video"
      width="1.4"
      height="0.8"
      position="0 0.04 0"
      rotation="-90 0 0">
    </a-video>

    <!-- Bouton Play légèrement au-dessus de la vidéo -->
    <a-image
      id="playBtn"
      src="#play"
      width="0.3"
      height="0.3"
      position="0 0.045 0.01"
      rotation="-90 0 0"
      class="clickable">
    </a-image>

  </a-marker>

  <!-- Caméra -->
  <a-entity camera></a-entity>

</a-scene>

<script>
  const video = document.querySelector('#video');
  const playBtn = document.querySelector('#playBtn');
  const marker = document.querySelector('a-marker');

  // Lecture vidéo
  playBtn.addEventListener('click', () => {
    video.play();
    playBtn.setAttribute('visible', 'false');
  });

  // Pause quand le marqueur disparaît
  marker.addEventListener('markerLost', () => {
    video.pause();
    playBtn.setAttribute('visible', 'true');
  });

  // Sécurité mobile
  window.addEventListener('blur', () => {
    video.pause();
    playBtn.setAttribute('visible', 'true');
  });
</script>

</body>
</html>
