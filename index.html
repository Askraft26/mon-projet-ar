<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AR Holo - Final Fix</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    body { margin: 0; overflow: hidden; font-family: sans-serif; }
    #overlay {
      position: absolute; z-index: 999; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center;
      color: white; text-align: center; cursor: pointer;
    }
    .start-msg { border: 2px solid #00E676; padding: 20px; border-radius: 15px; background: rgba(0,230,118,0.1); }
  </style>
</head>

<body style="margin:0; overflow:hidden;">

  <div id="overlay">
    <div class="start-msg">
      <h1>ðŸš€ HOLO-PLAYER ACTIVÃ‰</h1>
      <p>Cliquez pour dÃ©marrer<br>puis visez le marqueur HIRO</p>
    </div>
  </div>

  <a-scene embedded 
           arjs="sourceType: webcam; debugUIEnabled: false;" 
           renderer="antialias: true; colorManagement: true;"
           cursor="rayOrigin: mouse" raycaster="objects: .clickable">
    
    <a-assets>
      <video id="maVideo" src="V2.mp4" crossorigin="anonymous" playsinline webkit-playsinline loop="true"></video>
    </a-assets>

    <a-marker preset="hiro" id="hiroMarker">
      <a-torus-knot radius="0.3" radius-tubular="0.05" color="#00E676" 
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-torus-knot>
    </a-marker>

    <a-entity id="fixedContent" visible="false" position="0 1.6 -3" scale="0.01 0.01 0.01">
      
      <a-video id="videoScreen" class="clickable" src="#maVideo" width="3.2" height="1.8" position="0 0.5 0"></a-video>
      
      <a-entity position="0 -0.6 0">
        <a-plane width="3.2" height="0.06" color="#222"></a-plane>
        <a-plane id="progressBar" width="0.1" height="0.06" color="#00E676" position="-1.6 0 0.01"></a-plane>
      </a-entity>

      <a-entity id="controls" position="0 -1.2 0">
        
        <a-entity id="btn-back" class="clickable" position="-1 0 0">
          <a-circle radius="0.3" color="#FFC65D"></a-circle>
          <a-text value="âª" align="center" width="3" position="0 0 0.05"></a-text>
        </a-entity>

        <a-entity id="btn-play" class="clickable" position="0 0 0">
          <a-circle radius="0.35" color="#FFF"></a-circle>
          <a-text id="playIcon" value="â¸ï¸" align="center" width="3.5" position="0 0 0.05" color="#000"></a-text>
        </a-entity>

        <a-entity id="btn-forward" class="clickable" position="1 0 0">
          <a-circle radius="0.3" color="#FFC65D"></a-circle>
          <a-text value="â©" align="center" width="3" position="0 0 0.05"></a-text>
        </a-entity>

      </a-entity>

    </a-entity>

    <a-entity camera look-controls>
      <a-cursor raycaster="objects: .clickable" color="#00E676"></a-cursor>
    </a-entity>

  </a-scene>

  <script>
    const video = document.querySelector("#maVideo");
    const fixedContent = document.querySelector("#fixedContent");
    const playIcon = document.querySelector("#playIcon");
    const progressBar = document.querySelector("#progressBar");

    // DÃ©marrage (bypass sÃ©curitÃ© navigateur)
    document.querySelector("#overlay").addEventListener('click', function() {
      this.style.display = 'none';
      video.play().then(() => video.pause());
    });

    // DÃ©tection Hiro + Zoom automatique
    document.querySelector("#hiroMarker").addEventListener("markerFound", () => {
      if (fixedContent.getAttribute("visible") === "false" || !fixedContent.getAttribute("visible")) {
        fixedContent.setAttribute("visible", "true");
        
        // Animation de Zoom (0.01 Ã  1)
        fixedContent.setAttribute("animation", {
          property: 'scale',
          to: '1 1 1',
          dur: 1200,
          easing: 'easeOutElastic'
        });
        
        video.play();
        playIcon.setAttribute("value", "â¸ï¸");
      }
    });

    // --- LOGIQUE DES BOUTONS ---

    function toggleVideo() {
      if (video.paused) {
        video.play();
        playIcon.setAttribute("value", "â¸ï¸");
      } else {
        video.pause();
        playIcon.setAttribute("value", "â–¶ï¸");
      }
    }

    // Assignation des Ã©vÃ©nements
    document.querySelector("#btn-play").addEventListener('click', (e) => {
      console.log("Play cliquÃ©");
      toggleVideo();
    });

    document.querySelector("#videoScreen").addEventListener('click', (e) => {
      console.log("Ã‰cran cliquÃ©");
      toggleVideo();
    });

    document.querySelector("#btn-back").addEventListener('click', (e) => {
      console.log("Back cliquÃ©");
      video.currentTime = Math.max(0, video.currentTime - 10);
    });

    document.querySelector("#btn-forward").addEventListener('click', (e) => {
      console.log("Forward cliquÃ©");
      video.currentTime = Math.min(video.duration, video.currentTime + 10);
    });

    // Barre de progression
    video.addEventListener('timeupdate', () => {
      const progress = video.currentTime / video.duration;
      if (!isNaN(progress)) {
        progressBar.setAttribute("width", progress * 3.2);
        progressBar.setAttribute("position", `${(progress * 3.2 / 2) - 1.6} 0 0.01`);
      }
    });
  </script>
</body>
</html>
